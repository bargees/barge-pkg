From 4fb4b1700c5370c40effc8543755bab8a7f380b6 Mon Sep 17 00:00:00 2001
From: "A.I" <ailis@paw.zone>
Date: Fri, 10 Aug 2018 10:19:00 -0700
Subject: [PATCH] Fix for CVE-2017-12424

Fix buffer overflow if NULL line is present in db.
---
 lib/commonio.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/lib/commonio.c b/lib/commonio.c
index cc536bf..82cccb9 100644
--- a/lib/commonio.c
+++ b/lib/commonio.c
@@ -754,16 +754,16 @@ commonio_sort (struct commonio_db *db, int (*cmp) (const void *, const void *))
 	for (ptr = db->head;
 	        (NULL != ptr)
 #if KEEP_NIS_AT_END
-	     && (NULL != ptr->line)
-	     && (   ('+' != ptr->line[0])
-	         && ('-' != ptr->line[0]))
+	     && ((NULL == ptr->line)
+	         || (('+' != ptr->line[0])
+	             && ('-' != ptr->line[0])))
 #endif
 	     ;
 	     ptr = ptr->next) {
 		n++;
 	}
 #if KEEP_NIS_AT_END
-	if ((NULL != ptr) && (NULL != ptr->line)) {
+	if (NULL != ptr) {
 		nis = ptr;
 	}
 #endif
-- 
2.14.1

